<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Dns | Bowen's Blog]]></title>
  <link href="http://iambowen.github.com/blog/categories/dns/atom.xml" rel="self"/>
  <link href="http://iambowen.github.com/"/>
  <updated>2016-11-19T22:34:38+11:00</updated>
  <id>http://iambowen.github.com/</id>
  <author>
    <name><![CDATA[Bowen Ma]]></name>
    <email><![CDATA[iambowen.m@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Issue Raised by DNS]]></title>
    <link href="http://iambowen.github.com/dns/2016/11/15/issue-raised-by-dns"/>
    <updated>2016-11-15T21:33:22+11:00</updated>
    <id>http://iambowen.github.com/dns/2016/11/15/issue-raised-by-dns</id>
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å®¢æˆ·ç°åœºå‡ºå·®ï¼Œè§è¯äº†ä¸å°‘æœ‰è¶£çš„çº¿ä¸Šäº‹æ•…ï¼Œä¸‹é¢è¦è®²çš„å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚
ä¸€æ®µæ—¶é—´ä¾èµ–ï¼ŒæŸä¸ªå¾®æœåŠ¡åœ¨ç”Ÿäº§ç¯å¢ƒçš„responseçš„å»¶è¿Ÿé™¡ç„¶å¢åŠ äº†å‡ ç™¾æ¯«ç§’ï¼Œè€Œéƒ¨ç½²çš„ä»£ç å¹¶ä¸æ˜¯é€ æˆå»¶è¿ŸåŸå› ã€‚ä»Newrelicçš„ç›‘æ§å¯ä»¥å‘ç°ï¼Œè¯¥APIçš„å»¶è¿Ÿå¢å¤§çš„ä¸»è¦åŸå› æ˜¯å®ƒä¾èµ–çš„ä¸€ä¸ªæœåŠ¡å“åº”æ—¶é—´å¢å¤§äº†ã€‚</p>

<p>æˆ‘ä»¬æš‚ä¸”æŠŠè¿™ä¸ªå¤–éƒ¨çš„æœåŠ¡ç§°ä¸ºservice.mycompany.comï¼Œè¿™ä¸ªæœåŠ¡åˆ†åˆ«éƒ¨ç½²åœ¨æ¾³æ´²å’Œæ¬§æ´²çš„ä¸¤ä¸ªæ•°æ®ä¸­å¿ƒï¼Œå…¥å£å¤„æ˜¯Akamaiï¼Œåšè´Ÿè½½å‡è¡¡ï¼Œå°½å¯èƒ½çš„æŒ‰ç…§è®¿é—®æ¥æºå»åˆ†å‘è¯·æ±‚ã€‚</p>

<p>è¯¥å¾®æœåŠ¡éƒ¨ç½²åœ¨AWSæ‚‰å°¼çš„æ•°æ®ä¸­å¿ƒï¼Œæ‰€ä»¥ç†è®ºä¸Šæ¥è®²ï¼Œå½“å®ƒè¯·æ±‚service.mycompany.comæ—¶ï¼ŒAkamaiåº”è¯¥è¿”å›çš„æ˜¯ä½äºæ‚‰å°¼çš„edgeèŠ‚ç‚¹çš„IPï¼ŒåŒæ—¶å…¶è®¿é—®çš„originæœåŠ¡å™¨ä¹Ÿåº”è¯¥ä½äºæ‚‰å°¼ã€‚ä½†æ˜¯é€šè¿‡åœ¨è¯¥å¾®æœåŠ¡çš„æœåŠ¡å™¨debugï¼Œå‘ç°pingå€¼ä»¥åŠtracerouteçš„å€¼éƒ½æ¯”è¾ƒé«˜ï¼ŒåŠå…¬å®¤è®¿é—®å´éƒ½ä¸€åˆ‡æ­£å¸¸ã€‚å½“æ—¶æ€€ç–‘æ˜¯Akamaiçš„GEOIPåˆ¤æ–­å‡ºäº†é—®é¢˜ï¼ŒæŠŠæ¥è‡ªäºšé©¬é€Šæ‚‰å°¼çš„è¯·æ±‚å½“æˆäº†æ¥è‡ªç¾å›½çš„IPçš„è¯·æ±‚ï¼Œäºæ˜¯ç”¨éƒ¨ç½²äºæ¬§æ´²çš„æ•°æ®ä¸­å¿ƒçš„æœåŠ¡å¤„ç†è¯·æ±‚ã€‚å’ŒåŸºç¡€è®¾æ–½éƒ¨é—¨ç®¡ç†ç½‘ç»œçš„äººè®¨è®ºï¼Œå†æ¬¡è°ƒæŸ¥åç»“è®ºç±»ä¼¼ã€‚</p>

<p>é—®é¢˜å‡ºåœ¨è¿™ä¸ªAWSè´¦æˆ·ä¸‹çš„VPCçš„DHCP optionsçš„é…ç½®ã€‚å› ä¸ºæ˜¯æ¯”è¾ƒæ—©æœŸä½¿ç”¨çš„shareçš„AWSè´¦æˆ·ï¼Œæ‰€ä»¥ä¸‹é¢çš„ç½‘ç»œé…ç½®æ¯”è¾ƒå¤æ‚ï¼Œé…ç½®æœ‰Direct Connect è¿å¾€å…¶ä»–æ•°æ®ä¸­å¿ƒï¼Œä»¥åŠå¾ˆå¤šVPC Peeringã€‚ä¸çŸ¥é“å› ä¸ºä»€ä¹ˆåŸå› ï¼Œè¿™ä¸ªå¾®æœåŠ¡éƒ¨ç½²çš„Cloudformation templateé‡Œé¢é€‰æ‹©äº†åŒ…å«google DNS <code>8.8.8.8</code>å’Œ<code>8.8.8.4</code>çš„DHCP Optionsã€‚æˆ‘ä»¬éƒ½çŸ¥é“å¯¹äºåœ¨Akamaiä¸Šæ³¨å†Œçš„æœåŠ¡service.mycompany.comæ¥è¯´ï¼Œå¦‚:
<code>
 ~&gt; host service.mycompany.com
service.mycompany.com is an alias for mycompany.generic.edgekey.net.
mycompany.generic.edgekey.net is an alias for e8888.g.akamaiedge.net.
e8888.g.akamaiedge.net has address 104.116.190.24
</code>
ç¬¬ä¸€æ¬¡DNSè¯·æ±‚è¿”å›çš„è®°å½•æ˜¯CNameï¼Œä¹‹åè¿›ä¸€æ­¥è¿”å›AkamaiåŠ¨æ€DNSçš„CNameï¼Œä¹Ÿå°±æ˜¯edge serverçš„CNameï¼Œä¹‹åå†æ ¹æ®DNSæœåŠ¡å™¨è¿”å›å¯¹åº”çš„edgeæœåŠ¡å™¨çš„IPåœ°å€ï¼Œå¦‚æœæŸ¥è¯¢çš„æ˜¯Googleçš„DNSï¼Œé‚£ä¹ˆå®ƒä¼šè¿”å›ç¾å›½çš„edgeæœåŠ¡å™¨åœ°å€â€¦â€¦ã€‚æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸‹:</p>

<pre><code> ~&gt; dig @8.8.8.8 service.mycompany.com

; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; @8.8.8.8 service.mycompany.com
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 44304
;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;service.mycompany.com. IN  A

;; ANSWER SECTION:
service.mycompany.com. 86399 IN CNAME   mycompany.generic.edgekey.net.
mycompany.generic.edgekey.net. 263  IN  CNAME   e8888.g.akamaiedge.net.
e8888.g.akamaiedge.net. 19  IN  A   23.53.156.156

;; Query time: 603 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Tue Nov 15 22:15:52 2016
;; MSG SIZE  rcvd: 130
</code></pre>

<p>æŸ¥è¯¢ä¸‹IPåœ°å€ä¿¡æ¯ï¼Œ
<code>
 ~&gt; whois 23.53.156.156 | grep Country
Country:        US
</code>
æ‰€ä»¥ï¼Œè¿™ä¸ªå¾®æœåŠ¡çš„è¯·æ±‚å…ˆåˆ°Akamaiç¾å›½çš„edgeæœåŠ¡å™¨ï¼Œä¹‹åå¾ˆæœ‰å¯èƒ½è¯·æ±‚è¢«å‘é€åˆ°äº†æ¬§æ´²çš„originæœåŠ¡å™¨ï¼Œè¿™ä¸ªå»¶è¿Ÿä¸å¢åŠ æ‰ğŸ‘»äº†â€¦â€¦ã€‚</p>

<p>è§£å†³çš„åŠæ³•å¾ˆç®€å•ï¼Œæ›´æ–°é…ç½®ï¼ŒDHCP Optionsé€‰æ‹©Amazonæä¾›çš„DNSå°±å¯ä»¥äº†ï¼Œå“åº”æ—¶é—´å°±é™ä¸‹å»äº†ã€‚</p>

<p>è¿™ä¸ªäº‹æƒ…ç»™æˆ‘ä»¬çš„æ•™è®­å°±æ˜¯ï¼Œä¸ç®¡æ€ä¹ˆæ ·éƒ½ä¸èƒ½å´‡æ´‹åªšå¤–ï¼Œè™½ç„¶æ¾³æ´²ä¸€ç›´followç¾å›½ï¼Œä½†æ˜¯DNSè¿˜æ˜¯å¾—ç”¨è‡ªå·±çš„ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hand Over DNS Resolve to VirutalBox]]></title>
    <link href="http://iambowen.github.com/virutalbox/dns/network/2016/01/20/hand-over-dns-resolve-to-virutalbox"/>
    <updated>2016-01-20T20:16:12+11:00</updated>
    <id>http://iambowen.github.com/virutalbox/dns/network/2016/01/20/hand-over-dns-resolve-to-virutalbox</id>
    <content type="html"><![CDATA[<p>å½“ä½ ç”¨<a href="https://www.vagrantup.com/">vagrant</a>æ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœº(driver ä¸ºvirtualbox)å¹¶ä½¿ç”¨NATæ–¹å¼è®©guestè™šæ‹Ÿæœºè¿æ¥å¤–ç½‘æ—¶ï¼Œå¦‚æœæœ‰æ— çº¿ç½‘ç»œçš„å˜åŒ–ï¼Œè™šæ‹Ÿæœºä¸­<code>/etc/resolv.conf</code>ä¸ä¼šå¯¹åº”çš„ä¿®æ”¹ï¼Œå¯¼è‡´åŸŸåè§£æå¤±è´¥ã€‚</p>

<p>è§£å†³çš„åŠæ³•æ˜¯å°†DNSè§£æçš„ä»»åŠ¡äº¤ç»™è™šæ‹Ÿæœºç®¡ç†å·¥å…·å¦‚virtualboxï¼Œå‡è®¾æˆ‘ä»¬è¦ä¿®æ”¹åä¸º<code>test</code>çš„è™šæ‹Ÿæœºçš„è®¾ç½®ï¼š</p>

<pre><code> ~&gt; VBoxManage list vms
"mesos1" {74214693-3477-4386-a9b7-4abc3b7e608d}
.......
"test" {b269c98f-00e8-49a3-a8d0-53629187ea62}

#ä¿è¯vmæ²¡æœ‰åœ¨è¿è¡Œï¼Œç„¶åæ‰§è¡Œ
 ~&gt; VBoxManage modifyvm test  --natdnsproxy1 on
</code></pre>

<p>é‡æ–°å¯åŠ¨vmï¼Œä¸ç®¡æ€ä¹ˆåˆ‡æ¢ç½‘ç»œï¼Œåº”è¯¥éƒ½ä¸ä¼šå†å‡ºç°åŸŸåè§£æçš„é—®é¢˜ã€‚
å¦‚æœæ˜¯ç”¨Vagrantfileç®¡ç†è™šæ‹Ÿæœºçš„é…ç½®ï¼Œå¯ä»¥æ›´æ”¹vmçš„é…ç½®ï¼š</p>

<pre><code>config.vm.provider "virtualbox" do |v|
  v.customize ["modifyvm", :id, "--natdnsproxy1", "on"]
end
</code></pre>
]]></content>
  </entry>
  
</feed>
