
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Mysql--on Duplicate Key Update - Bowen's Blog</title>
  <meta name="author" content="Bowen Ma">

  
  <meta name="description" content="On duplicate key update is to stop the duplication in unique index or primary
key, and try to update the row with new value.And it only functions &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://iambowen.github.com/mysql/2011/11/26/on-duplicate-key-update">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Bowen's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-40335675-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Bowen's Blog</a></h1>
  
    <h2>Respect My Authorita.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="iambowen.m@gmail.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="iambowen.github.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Mysql--on Duplicate Key Update</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-11-26T00:00:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://iambowen.github.com">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>On duplicate key update is to stop the duplication in unique index or primary
key, and try to update the row with new value.And it only functions with mysql
because it is not standard SQL grammar.</p>

<p>Create database and choose it</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysql&gt; create database <span class="nb">test</span><span class="p">;</span>
</span><span class='line'>Query OK, <span class="m">1</span> row affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span><span class='line'>mysql&gt; use <span class="nb">test</span><span class="p">;</span>
</span><span class='line'>Database changed
</span></code></pre></td></tr></table></div></figure>


<p>Create a table with primary key</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysql&gt; create table pet<span class="o">(</span>a CHAR<span class="o">(</span>1<span class="o">)</span>, b CHAR<span class="o">(</span>1<span class="o">)</span>, primary key<span class="o">(</span>a<span class="o">))</span><span class="p">;</span>
</span><span class='line'>Query OK, <span class="m">0</span> rows affected <span class="o">(</span>0.06 sec<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>And initialize a row</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysql&gt; insert into pet values<span class="o">(</span><span class="s1">&#39;1&#39;</span>, <span class="s1">&#39;2&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>Query OK, <span class="m">1</span> row affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>insert new value with the same primary key</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysql&gt; insert into pet values<span class="o">(</span><span class="s1">&#39;1&#39;</span>, <span class="s1">&#39;3&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>ERROR <span class="m">1062</span> <span class="o">(</span>23000<span class="o">)</span>: Duplicate entry <span class="s1">&#39;1&#39;</span> <span class="k">for</span> key <span class="s1">&#39;PRIMARY&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>drop primary key property</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysql&gt; alter table pet drop PRIMARY KEY<span class="p">;</span>
</span><span class='line'>Query OK, <span class="m">1</span> row affected <span class="o">(</span>0.06 sec<span class="o">)</span>
</span><span class='line'>Records: <span class="m">1</span>  Duplicates: <span class="m">0</span>  Warnings: 0
</span></code></pre></td></tr></table></div></figure>


<p>insert again, cool, done</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysql&gt; insert into pet values<span class="o">(</span><span class="s1">&#39;1&#39;</span>, <span class="s1">&#39;3&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>Query OK, <span class="m">1</span> row affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>what we have now? values with duplicated key</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysql&gt; <span class="k">select</span> * from pet<span class="p">;</span>
</span><span class='line'>+---+------+
</span><span class='line'><span class="p">|</span> a <span class="p">|</span> b    <span class="p">|</span>
</span><span class='line'>+---+------+
</span><span class='line'><span class="p">|</span> <span class="m">1</span> <span class="p">|</span> <span class="m">2</span>    <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">1</span> <span class="p">|</span> <span class="m">3</span>    <span class="p">|</span>
</span><span class='line'>+---+------+
</span></code></pre></td></tr></table></div></figure>


<p>change the primary key back</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysql&gt; alter table pet add primary key<span class="o">(</span>b<span class="o">)</span><span class="p">;</span>
</span><span class='line'>Query OK, <span class="m">2</span> rows affected <span class="o">(</span>0.11 sec<span class="o">)</span>
</span><span class='line'>Records: <span class="m">2</span>  Duplicates: <span class="m">0</span>  Warnings: 0
</span></code></pre></td></tr></table></div></figure>


<p>insert the value with  on duplicate key update</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysql&gt; insert into pet values<span class="o">(</span><span class="s1">&#39;4&#39;</span>, <span class="s1">&#39;3&#39;</span><span class="o">)</span> on duplicate key update <span class="nv">a</span> <span class="o">=</span> values<span class="o">(</span>a<span class="o">)</span><span class="p">;</span>
</span><span class='line'>Query OK, <span class="m">2</span> rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>the result:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysql&gt; <span class="k">select</span> * from pet<span class="p">;</span>
</span><span class='line'>+---+---+
</span><span class='line'><span class="p">|</span> a <span class="p">|</span> b <span class="p">|</span>
</span><span class='line'>+---+---+
</span><span class='line'><span class="p">|</span> <span class="m">1</span> <span class="p">|</span> <span class="m">2</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">4</span> <span class="p">|</span> <span class="m">3</span> <span class="p">|</span>
</span><span class='line'>+---+---+
</span><span class='line'><span class="m">2</span> rows in <span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Bowen Ma</span></span>

      




<time class='entry-date' datetime='2011-11-26T00:00:00+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/mysql/'>mysql</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://iambowen.github.com/mysql/2011/11/26/on-duplicate-key-update" data-via="boweniam" data-counturl="http://iambowen.github.com/mysql/2011/11/26/on-duplicate-key-update" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/tools/2011/11/09/set-up-github-pages" title="Previous Post: set up github page">&laquo; set up github page</a>
      
      
        <a class="basic-alignment right" href="/ruby/2011/11/29/invalid-gemspec-because-of-the-date-format-in-specification" title="Next Post: Invalid gemspec because of the date format in specification">Invalid gemspec because of the date format in specification &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/akamai/diagnostic/2016/01/19/using-akamai-diagnostic-tools-slash-api">Using Akamai Diagnostic tools/API</a>
      </li>
    
      <li class="post">
        <a href="/ci/mesos/aws/2016/01/10/ci-solution-with-mesos">Ci Solution With Mesos</a>
      </li>
    
      <li class="post">
        <a href="/aws/practice/2015/12/28/stopping-creating-new-wheels">Stop Wrapping AWS SDK to Create Tools</a>
      </li>
    
      <li class="post">
        <a href="/ssh/security/2015/12/19/ssh-securely-and-handy">更加安全和简单的方式通过堡垒机ssh</a>
      </li>
    
      <li class="post">
        <a href="/ssh/practice/2015/12/17/dont-copy-slash-paste-keys-from-chatting-tools">Don't Copy/paste Keys From Chatting Tools</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/iambowen">@iambowen</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'iambowen',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/iambowen.m@gmail.com?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Bowen Ma -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'iambowen';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
